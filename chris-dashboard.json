{
    "__inputs": [
      {
        "name": "DS_PROMETHEUS",
        "label": "Prometheus",
        "description": "",
        "type": "datasource",
        "pluginId": "prometheus",
        "pluginName": "Prometheus"
      },
      {
        "name": "DS_CHRIS_POSTGRESQL",
        "label": "ChRIS PostgreSQL",
        "description": "",
        "type": "datasource",
        "pluginId": "postgres",
        "pluginName": "PostgreSQL"
      },
      {
        "name": "DS_CHRIS_LOKI",
        "label": "ChRIS Loki",
        "description": "",
        "type": "datasource",
        "pluginId": "loki",
        "pluginName": "Loki"
      }
    ],
    "__elements": {},
    "__requires": [
      {
        "type": "panel",
        "id": "gauge",
        "name": "Gauge",
        "version": ""
      },
      {
        "type": "grafana",
        "id": "grafana",
        "name": "Grafana",
        "version": "10.1.5"
      },
      {
        "type": "panel",
        "id": "logs",
        "name": "Logs",
        "version": ""
      },
      {
        "type": "datasource",
        "id": "loki",
        "name": "Loki",
        "version": "1.0.0"
      },
      {
        "type": "datasource",
        "id": "postgres",
        "name": "PostgreSQL",
        "version": "1.0.0"
      },
      {
        "type": "datasource",
        "id": "prometheus",
        "name": "Prometheus",
        "version": "1.0.0"
      },
      {
        "type": "panel",
        "id": "table",
        "name": "Table",
        "version": ""
      },
      {
        "type": "panel",
        "id": "timeseries",
        "name": "Time series",
        "version": ""
      }
    ],
    "annotations": {
      "list": [
        {
          "builtIn": 1,
          "datasource": {
            "type": "grafana",
            "uid": "-- Grafana --"
          },
          "enable": true,
          "hide": true,
          "iconColor": "rgba(0, 211, 255, 1)",
          "name": "Annotations & Alerts",
          "type": "dashboard"
        }
      ]
    },
    "editable": true,
    "fiscalYearStartMonth": 0,
    "graphTooltip": 0,
    "id": null,
    "links": [],
    "liveNow": false,
    "panels": [
      {
        "collapsed": false,
        "gridPos": {
          "h": 1,
          "w": 24,
          "x": 0,
          "y": 0
        },
        "id": 27,
        "panels": [],
        "title": "Plugin Metrics",
        "type": "row"
      },
      {
        "datasource": {
          "type": "prometheus",
          "uid": "${DS_PROMETHEUS}"
        },
        "fieldConfig": {
          "defaults": {
            "color": {
              "mode": "palette-classic"
            },
            "custom": {
              "axisCenteredZero": false,
              "axisColorMode": "text",
              "axisLabel": "",
              "axisPlacement": "left",
              "barAlignment": 0,
              "drawStyle": "line",
              "fillOpacity": 0,
              "gradientMode": "none",
              "hideFrom": {
                "legend": false,
                "tooltip": false,
                "viz": false
              },
              "insertNulls": false,
              "lineInterpolation": "linear",
              "lineWidth": 1,
              "pointSize": 5,
              "scaleDistribution": {
                "type": "linear"
              },
              "showPoints": "auto",
              "spanNulls": false,
              "stacking": {
                "group": "A",
                "mode": "none"
              },
              "thresholdsStyle": {
                "mode": "off"
              }
            },
            "mappings": [],
            "noValue": "0",
            "thresholds": {
              "mode": "absolute",
              "steps": [
                {
                  "color": "green",
                  "value": null
                },
                {
                  "color": "red",
                  "value": 80
                }
              ]
            }
          },
          "overrides": [
            {
              "matcher": {
                "id": "byName",
                "options": "CPU Usage"
              },
              "properties": [
                {
                  "id": "unit",
                  "value": "none"
                },
                {
                  "id": "custom.axisPlacement",
                  "value": "right"
                }
              ]
            },
            {
              "matcher": {
                "id": "byName",
                "options": "Memory Usage (Working Set)"
              },
              "properties": [
                {
                  "id": "unit",
                  "value": "decbytes"
                },
                {
                  "id": "custom.axisPlacement",
                  "value": "left"
                }
              ]
            },
            {
              "matcher": {
                "id": "byName",
                "options": "Runtime"
              },
              "properties": [
                {
                  "id": "unit",
                  "value": "s"
                },
                {
                  "id": "custom.axisPlacement",
                  "value": "auto"
                }
              ]
            }
          ]
        },
        "gridPos": {
          "h": 8,
          "w": 12,
          "x": 0,
          "y": 1
        },
        "id": 39,
        "interval": "15s",
        "options": {
          "legend": {
            "calcs": [],
            "displayMode": "list",
            "placement": "bottom",
            "showLegend": true
          },
          "tooltip": {
            "mode": "single",
            "sort": "none"
          }
        },
        "pluginVersion": "10.1.5",
        "targets": [
          {
            "datasource": {
              "type": "prometheus",
              "uid": "${DS_PROMETHEUS}"
            },
            "disableTextWrap": false,
            "editorMode": "builder",
            "expr": "sum by (image) (   pod:container_cpu_usage:sum{}   * on(namespace, pod) group_right(image) kube_pod_container_info{image=~\"$ChRIS_Plugin_Image\"} )",
            "fullMetaSearch": false,
            "includeNullMetadata": true,
            "instant": false,
            "legendFormat": "CPU Usage",
            "range": true,
            "refId": "A",
            "useBackend": false
          },
          {
            "datasource": {
              "type": "prometheus",
              "uid": "${DS_PROMETHEUS}"
            },
            "disableTextWrap": false,
            "editorMode": "builder",
            "expr": "sum(container_memory_working_set_bytes{image=~\"$ChRIS_Plugin_Image\"})",
            "fullMetaSearch": false,
            "hide": false,
            "includeNullMetadata": true,
            "instant": false,
            "legendFormat": "Memory Usage (Working Set)",
            "range": true,
            "refId": "B",
            "useBackend": false
          },
          {
            "datasource": {
              "type": "prometheus",
              "uid": "${DS_PROMETHEUS}"
            },
            "disableTextWrap": false,
            "editorMode": "builder",
            "expr": "avg by (image) (last_over_time(timestamp((kube_pod_start_time{}   * on(namespace, pod) group_right(image) kube_pod_container_info{image_spec=~\"$ChRIS_Plugin_Image\"}))[1w:]) -    (kube_pod_start_time{}   * on(namespace, pod) group_right(image) kube_pod_container_info{image_spec=~\"$ChRIS_Plugin_Image\"}))",
            "fullMetaSearch": false,
            "hide": false,
            "includeNullMetadata": true,
            "instant": false,
            "legendFormat": "Runtime",
            "range": true,
            "refId": "C",
            "useBackend": false
          }
        ],
        "title": "Average CPU, Memory Use, and Runtime by ChRIS Plugin Image Type(s)",
        "type": "timeseries"
      },
      {
        "datasource": {
          "type": "prometheus",
          "uid": "${DS_PROMETHEUS}"
        },
        "fieldConfig": {
          "defaults": {
            "color": {
              "mode": "palette-classic"
            },
            "custom": {
              "axisCenteredZero": false,
              "axisColorMode": "text",
              "axisLabel": "",
              "axisPlacement": "auto",
              "barAlignment": 0,
              "drawStyle": "line",
              "fillOpacity": 0,
              "gradientMode": "none",
              "hideFrom": {
                "legend": false,
                "tooltip": false,
                "viz": false
              },
              "insertNulls": false,
              "lineInterpolation": "linear",
              "lineWidth": 1,
              "pointSize": 5,
              "scaleDistribution": {
                "type": "linear"
              },
              "showPoints": "auto",
              "spanNulls": false,
              "stacking": {
                "group": "A",
                "mode": "none"
              },
              "thresholdsStyle": {
                "mode": "off"
              }
            },
            "mappings": [],
            "min": 0,
            "noValue": "0",
            "thresholds": {
              "mode": "absolute",
              "steps": [
                {
                  "color": "green",
                  "value": null
                },
                {
                  "color": "red",
                  "value": 80
                }
              ]
            }
          },
          "overrides": []
        },
        "gridPos": {
          "h": 8,
          "w": 6,
          "x": 12,
          "y": 1
        },
        "id": 14,
        "options": {
          "legend": {
            "calcs": [],
            "displayMode": "list",
            "placement": "bottom",
            "showLegend": true
          },
          "tooltip": {
            "mode": "single",
            "sort": "none"
          }
        },
        "targets": [
          {
            "datasource": {
              "type": "prometheus",
              "uid": "${DS_PROMETHEUS}"
            },
            "disableTextWrap": false,
            "editorMode": "builder",
            "expr": "sum by (image) (   kube_pod_container_info{image=~\"$ChRIS_Plugin_Image\"} ) ",
            "fullMetaSearch": false,
            "includeNullMetadata": true,
            "instant": false,
            "legendFormat": "__auto",
            "range": true,
            "refId": "A",
            "useBackend": false
          }
        ],
        "title": "Number of ChRIS Plugin Image Type(s) Plugins Ran",
        "type": "timeseries"
      },
      {
        "datasource": {
          "type": "prometheus",
          "uid": "${DS_PROMETHEUS}"
        },
        "fieldConfig": {
          "defaults": {
            "color": {
              "mode": "palette-classic"
            },
            "custom": {
              "axisCenteredZero": false,
              "axisColorMode": "text",
              "axisLabel": "",
              "axisPlacement": "auto",
              "barAlignment": 0,
              "drawStyle": "line",
              "fillOpacity": 0,
              "gradientMode": "none",
              "hideFrom": {
                "legend": false,
                "tooltip": false,
                "viz": false
              },
              "insertNulls": false,
              "lineInterpolation": "linear",
              "lineWidth": 1,
              "pointSize": 5,
              "scaleDistribution": {
                "type": "linear"
              },
              "showPoints": "auto",
              "spanNulls": false,
              "stacking": {
                "group": "A",
                "mode": "none"
              },
              "thresholdsStyle": {
                "mode": "off"
              }
            },
            "mappings": [],
            "min": 0,
            "noValue": "0",
            "thresholds": {
              "mode": "absolute",
              "steps": [
                {
                  "color": "green",
                  "value": null
                },
                {
                  "color": "red",
                  "value": 80
                }
              ]
            },
            "unit": "short"
          },
          "overrides": []
        },
        "gridPos": {
          "h": 8,
          "w": 6,
          "x": 18,
          "y": 1
        },
        "id": 12,
        "interval": "15s",
        "options": {
          "legend": {
            "calcs": [],
            "displayMode": "list",
            "placement": "bottom",
            "showLegend": true
          },
          "tooltip": {
            "mode": "single",
            "sort": "none"
          }
        },
        "pluginVersion": "10.1.5",
        "targets": [
          {
            "datasource": {
              "type": "prometheus",
              "uid": "${DS_PROMETHEUS}"
            },
            "editorMode": "code",
            "expr": "sum by (image) (\n  kube_pod_container_info{image=~\".+fnndsc.+\", image!~\"ghcr.io/fnndsc/pfcon.+\", image!~\"ghcr.io/fnndsc/pman.+\", image!~\"ghcr.io/fnndsc/cube.+\", image!~\"ghcr.io/fnndsc/aiochris.+\"}\n) ",
            "legendFormat": "__auto",
            "range": true,
            "refId": "A"
          }
        ],
        "title": "Number of Plugins Running by Image Type (All)",
        "type": "timeseries"
      },
      {
        "datasource": {
          "type": "postgres",
          "uid": "${DS_CHRIS_POSTGRESQL}"
        },
        "fieldConfig": {
          "defaults": {
            "color": {
              "mode": "thresholds"
            },
            "custom": {
              "align": "auto",
              "cellOptions": {
                "type": "auto"
              },
              "inspect": false
            },
            "mappings": [],
            "thresholds": {
              "mode": "absolute",
              "steps": [
                {
                  "color": "green",
                  "value": null
                },
                {
                  "color": "red",
                  "value": 80
                }
              ]
            }
          },
          "overrides": [
            {
              "matcher": {
                "id": "byName",
                "options": "dock_image"
              },
              "properties": [
                {
                  "id": "displayName",
                  "value": "Plugin Image"
                },
                {
                  "id": "custom.minWidth",
                  "value": 225
                }
              ]
            },
            {
              "matcher": {
                "id": "byName",
                "options": "error_code"
              },
              "properties": [
                {
                  "id": "custom.minWidth",
                  "value": 100
                }
              ]
            },
            {
              "matcher": {
                "id": "byName",
                "options": "Status"
              },
              "properties": [
                {
                  "id": "custom.minWidth",
                  "value": 100
                }
              ]
            },
            {
              "matcher": {
                "id": "byName",
                "options": "Plugin id"
              },
              "properties": [
                {
                  "id": "custom.minWidth",
                  "value": 75
                }
              ]
            },
            {
              "matcher": {
                "id": "byName",
                "options": "Feed id"
              },
              "properties": [
                {
                  "id": "custom.minWidth",
                  "value": 75
                }
              ]
            },
            {
              "matcher": {
                "id": "byName",
                "options": "Previous id"
              },
              "properties": [
                {
                  "id": "custom.minWidth",
                  "value": 90
                }
              ]
            },
            {
              "matcher": {
                "id": "byName",
                "options": "User"
              },
              "properties": [
                {
                  "id": "custom.minWidth",
                  "value": 120
                }
              ]
            }
          ]
        },
        "gridPos": {
          "h": 8,
          "w": 12,
          "x": 0,
          "y": 9
        },
        "id": 22,
        "options": {
          "cellHeight": "sm",
          "footer": {
            "countRows": false,
            "fields": "",
            "reducer": [
              "sum"
            ],
            "show": false
          },
          "showHeader": true,
          "sortBy": [
            {
              "desc": false,
              "displayName": "compute_resource_id"
            }
          ]
        },
        "pluginVersion": "10.1.5",
        "targets": [
          {
            "datasource": {
              "type": "postgres",
              "uid": "${DS_CHRIS_POSTGRESQL}"
            },
            "editorMode": "code",
            "format": "table",
            "rawQuery": true,
            "rawSql": "SELECT \n\tplugins_plugin.dock_image,\n\tplugininstances_plugininstance.error_code, \n\tplugininstances_plugininstance.feed_id AS \"Feed id\",\n\tplugininstances_plugininstance.id AS \"Plugin id\",\n\tplugininstances_plugininstance.previous_id AS \"Previous id\",\n\tplugininstances_plugininstance.status AS \"Status\",\n\tauth_user.username AS \"User\",\n\tplugins_computeresource.name AS \"Compute Resource\",\n\tplugininstances_plugininstance.start_date AS \"Start Date\",\n\tplugininstances_plugininstance.end_date AS \"End Date\",\n\tplugininstances_plugininstance.summary AS \"Summary\"\n\t\nFROM plugininstances_plugininstance\nINNER JOIN plugins_computeresource ON plugins_computeresource.id = plugininstances_plugininstance.compute_resource_id\nINNER JOIN auth_user ON auth_user.id = plugininstances_plugininstance.owner_id\nINNER JOIN plugins_plugin ON plugins_plugin.id = plugininstances_plugininstance.plugin_id\nWHERE plugininstances_plugininstance.error_code != ''\nORDER BY plugininstances_plugininstance.end_date DESC\nLIMIT 50",
            "refId": "A",
            "sql": {
              "columns": [
                {
                  "parameters": [
                    {
                      "name": "*",
                      "type": "functionParameter"
                    }
                  ],
                  "type": "function"
                }
              ],
              "groupBy": [
                {
                  "property": {
                    "type": "string"
                  },
                  "type": "groupBy"
                }
              ],
              "limit": 50
            },
            "table": "auth_user"
          }
        ],
        "title": "Recent Plugin Errors",
        "type": "table"
      },
      {
        "datasource": {
          "type": "postgres",
          "uid": "${DS_CHRIS_POSTGRESQL}"
        },
        "fieldConfig": {
          "defaults": {
            "color": {
              "mode": "palette-classic"
            },
            "custom": {
              "axisCenteredZero": false,
              "axisColorMode": "text",
              "axisLabel": "",
              "axisPlacement": "auto",
              "barAlignment": 0,
              "drawStyle": "line",
              "fillOpacity": 0,
              "gradientMode": "none",
              "hideFrom": {
                "legend": false,
                "tooltip": false,
                "viz": false
              },
              "insertNulls": 30000,
              "lineInterpolation": "stepBefore",
              "lineStyle": {
                "fill": "solid"
              },
              "lineWidth": 1,
              "pointSize": 5,
              "scaleDistribution": {
                "type": "linear"
              },
              "showPoints": "auto",
              "spanNulls": false,
              "stacking": {
                "group": "A",
                "mode": "none"
              },
              "thresholdsStyle": {
                "mode": "off"
              }
            },
            "mappings": [],
            "min": 0,
            "noValue": "0",
            "thresholds": {
              "mode": "absolute",
              "steps": [
                {
                  "color": "green",
                  "value": null
                },
                {
                  "color": "red",
                  "value": 80
                }
              ]
            },
            "unit": "none"
          },
          "overrides": []
        },
        "gridPos": {
          "h": 8,
          "w": 12,
          "x": 12,
          "y": 9
        },
        "id": 25,
        "options": {
          "legend": {
            "calcs": [],
            "displayMode": "list",
            "placement": "bottom",
            "showLegend": true
          },
          "tooltip": {
            "mode": "single",
            "sort": "none"
          }
        },
        "pluginVersion": "10.1.5",
        "targets": [
          {
            "datasource": {
              "type": "postgres",
              "uid": "${DS_CHRIS_POSTGRESQL}"
            },
            "editorMode": "code",
            "format": "table",
            "hide": false,
            "rawQuery": true,
            "rawSql": "SELECT\n  generate_series(\n    DATE_TRUNC('minutes', plugininstances_plugininstance.start_date), \n    DATE_TRUNC(\n      'minutes', \n      CASE WHEN plugininstances_plugininstance.status = 'started' THEN now()\n      ELSE plugininstances_plugininstance.end_date\n      END\n    ), \n    '30 seconds'\n  ) as time_interval,\n  auth_user.username,\n  COUNT(*)\nFROM plugininstances_plugininstance\nINNER JOIN auth_user ON auth_user.id = plugininstances_plugininstance.owner_id\nWHERE status != 'cancelled' AND\nplugininstances_plugininstance.end_date BETWEEN '${__from:date:iso}' AND '${__to:date:iso}' OR\nplugininstances_plugininstance.end_date IS NULL\nGROUP BY time_interval, auth_user.username\nORDER BY time_interval DESC, auth_user.username;\n",
            "refId": "A",
            "sql": {
              "columns": [
                {
                  "parameters": [
                    {
                      "name": "start_date",
                      "type": "functionParameter"
                    }
                  ],
                  "type": "function"
                },
                {
                  "parameters": [
                    {
                      "name": "owner_id",
                      "type": "functionParameter"
                    }
                  ],
                  "type": "function"
                },
                {
                  "name": "COUNT",
                  "parameters": [
                    {
                      "name": "*",
                      "type": "functionParameter"
                    }
                  ],
                  "type": "function"
                }
              ],
              "groupBy": [
                {
                  "property": {
                    "name": "start_date",
                    "type": "string"
                  },
                  "type": "groupBy"
                },
                {
                  "property": {
                    "name": "owner_id",
                    "type": "string"
                  },
                  "type": "groupBy"
                }
              ],
              "limit": 50
            },
            "table": "plugininstances_plugininstance"
          }
        ],
        "title": "Number of Plugins Being Run by User",
        "transformations": [
          {
            "id": "groupBy",
            "options": {
              "fields": {
                "count": {
                  "aggregations": [
                    "sum"
                  ],
                  "operation": "aggregate"
                },
                "time_interval": {
                  "aggregations": [],
                  "operation": "groupby"
                },
                "username": {
                  "aggregations": [],
                  "operation": "groupby"
                }
              }
            }
          },
          {
            "id": "prepareTimeSeries",
            "options": {
              "format": "multi"
            }
          },
          {
            "id": "renameByRegex",
            "options": {
              "regex": "count \\(sum\\) (.*)",
              "renamePattern": "$1"
            }
          }
        ],
        "type": "timeseries"
      },
      {
        "datasource": {
          "type": "postgres",
          "uid": "${DS_CHRIS_POSTGRESQL}"
        },
        "fieldConfig": {
          "defaults": {
            "color": {
              "mode": "thresholds"
            },
            "custom": {
              "align": "auto",
              "cellOptions": {
                "type": "auto"
              },
              "inspect": false
            },
            "mappings": [],
            "thresholds": {
              "mode": "absolute",
              "steps": [
                {
                  "color": "green",
                  "value": null
                },
                {
                  "color": "red",
                  "value": 80
                }
              ]
            }
          },
          "overrides": [
            {
              "matcher": {
                "id": "byName",
                "options": "Plugin Image"
              },
              "properties": [
                {
                  "id": "custom.minWidth",
                  "value": 250
                }
              ]
            },
            {
              "matcher": {
                "id": "byName",
                "options": "Plugin id"
              },
              "properties": [
                {
                  "id": "custom.minWidth",
                  "value": 50
                },
                {
                  "id": "custom.width",
                  "value": 100
                }
              ]
            },
            {
              "matcher": {
                "id": "byName",
                "options": "Previous id"
              },
              "properties": [
                {
                  "id": "custom.minWidth",
                  "value": 50
                },
                {
                  "id": "custom.width",
                  "value": 100
                }
              ]
            }
          ]
        },
        "gridPos": {
          "h": 8,
          "w": 12,
          "x": 0,
          "y": 17
        },
        "id": 41,
        "options": {
          "cellHeight": "sm",
          "footer": {
            "countRows": false,
            "fields": "",
            "reducer": [
              "sum"
            ],
            "show": false
          },
          "showHeader": true
        },
        "pluginVersion": "10.1.5",
        "targets": [
          {
            "datasource": {
              "type": "postgres",
              "uid": "${DS_CHRIS_POSTGRESQL}"
            },
            "editorMode": "code",
            "format": "table",
            "rawQuery": true,
            "rawSql": "SELECT\n  auth_user.username \"Username\",\n  plugins_plugin.dock_image AS \"Plugin Image\",\n  plugininstances_plugininstance.id AS \"Plugin id\",\n  plugininstances_plugininstance.previous_id AS \"Previous id\",\n  plugininstances_plugininstance.start_date AS \"Start date\"\nFROM plugininstances_plugininstance\nINNER JOIN auth_user ON auth_user.id = plugininstances_plugininstance.owner_id\nINNER JOIN plugins_plugin ON plugins_plugin.id = plugininstances_plugininstance.plugin_id\nWHERE plugininstances_plugininstance.start_date BETWEEN $__timeFrom() AND $__timeTo()\nORDER BY plugininstances_plugininstance.start_date DESC\nLIMIT 50",
            "refId": "A",
            "sql": {
              "columns": [
                {
                  "parameters": [],
                  "type": "function"
                }
              ],
              "groupBy": [
                {
                  "property": {
                    "type": "string"
                  },
                  "type": "groupBy"
                }
              ],
              "limit": 50
            }
          }
        ],
        "title": "Plugins Ran in Grafana Time Range",
        "type": "table"
      },
      {
        "datasource": {
          "type": "prometheus",
          "uid": "${DS_PROMETHEUS}"
        },
        "fieldConfig": {
          "defaults": {
            "color": {
              "mode": "palette-classic"
            },
            "custom": {
              "axisCenteredZero": false,
              "axisColorMode": "text",
              "axisLabel": "",
              "axisPlacement": "left",
              "barAlignment": 0,
              "drawStyle": "line",
              "fillOpacity": 0,
              "gradientMode": "none",
              "hideFrom": {
                "legend": false,
                "tooltip": false,
                "viz": false
              },
              "insertNulls": false,
              "lineInterpolation": "linear",
              "lineWidth": 1,
              "pointSize": 5,
              "scaleDistribution": {
                "type": "linear"
              },
              "showPoints": "auto",
              "spanNulls": false,
              "stacking": {
                "group": "A",
                "mode": "none"
              },
              "thresholdsStyle": {
                "mode": "off"
              }
            },
            "mappings": [],
            "noValue": "0",
            "thresholds": {
              "mode": "absolute",
              "steps": [
                {
                  "color": "green",
                  "value": null
                },
                {
                  "color": "red",
                  "value": 80
                }
              ]
            }
          },
          "overrides": [
            {
              "matcher": {
                "id": "byName",
                "options": "CPU Usage"
              },
              "properties": [
                {
                  "id": "unit",
                  "value": "none"
                },
                {
                  "id": "custom.axisPlacement",
                  "value": "right"
                }
              ]
            },
            {
              "matcher": {
                "id": "byName",
                "options": "Memory Usage (Working Set)"
              },
              "properties": [
                {
                  "id": "unit",
                  "value": "decbytes"
                },
                {
                  "id": "custom.axisPlacement",
                  "value": "left"
                }
              ]
            },
            {
              "matcher": {
                "id": "byName",
                "options": "Runtime"
              },
              "properties": [
                {
                  "id": "unit",
                  "value": "s"
                },
                {
                  "id": "custom.axisPlacement",
                  "value": "auto"
                }
              ]
            }
          ]
        },
        "gridPos": {
          "h": 8,
          "w": 12,
          "x": 12,
          "y": 17
        },
        "id": 40,
        "interval": "15s",
        "options": {
          "legend": {
            "calcs": [],
            "displayMode": "list",
            "placement": "bottom",
            "showLegend": true
          },
          "tooltip": {
            "mode": "single",
            "sort": "none"
          }
        },
        "pluginVersion": "10.1.5",
        "targets": [
          {
            "datasource": {
              "type": "prometheus",
              "uid": "${DS_PROMETHEUS}"
            },
            "disableTextWrap": false,
            "editorMode": "code",
            "expr": "sum by (pod) (pod:container_cpu_usage:sum{pod=~\"chris-jid-$PluginPod.+\"})",
            "fullMetaSearch": false,
            "includeNullMetadata": true,
            "instant": false,
            "legendFormat": "{{pod}} CPU Usage",
            "range": true,
            "refId": "A",
            "useBackend": false
          },
          {
            "datasource": {
              "type": "prometheus",
              "uid": "${DS_PROMETHEUS}"
            },
            "disableTextWrap": false,
            "editorMode": "code",
            "expr": "sum (   container_memory_working_set_bytes{pod=~\"chris-jid-$PluginPod.+\"} ) by(pod)",
            "fullMetaSearch": false,
            "hide": false,
            "includeNullMetadata": true,
            "instant": false,
            "legendFormat": "Memory Usage (Working Set)",
            "range": true,
            "refId": "B",
            "useBackend": false
          },
          {
            "datasource": {
              "type": "prometheus",
              "uid": "${DS_PROMETHEUS}"
            },
            "disableTextWrap": false,
            "editorMode": "code",
            "expr": "avg by (pod) (last_over_time(timestamp(kube_pod_start_time{namespace=\"hosting-of-medical-image-analysis-platform-a88466\", pod=~\"chris-jid-$PluginPod.+\"})[1w:]) - kube_pod_start_time{namespace=\"hosting-of-medical-image-analysis-platform-a88466\", pod=~\"chris-jid-$PluginPod.+\"})",
            "fullMetaSearch": false,
            "hide": false,
            "includeNullMetadata": true,
            "instant": false,
            "legendFormat": "Runtime",
            "range": true,
            "refId": "C",
            "useBackend": false
          }
        ],
        "title": "Average CPU, Memory Use, and Runtime by Pod Number Input",
        "transformations": [],
        "type": "timeseries"
      },
      {
        "datasource": {
          "type": "postgres",
          "uid": "${DS_CHRIS_POSTGRESQL}"
        },
        "fieldConfig": {
          "defaults": {
            "color": {
              "mode": "thresholds"
            },
            "custom": {
              "align": "auto",
              "cellOptions": {
                "type": "auto"
              },
              "inspect": false
            },
            "mappings": [],
            "thresholds": {
              "mode": "absolute",
              "steps": [
                {
                  "color": "green",
                  "value": null
                },
                {
                  "color": "red",
                  "value": 80
                }
              ]
            }
          },
          "overrides": [
            {
              "matcher": {
                "id": "byName",
                "options": "Plugin"
              },
              "properties": [
                {
                  "id": "custom.minWidth",
                  "value": 250
                }
              ]
            },
            {
              "matcher": {
                "id": "byName",
                "options": "Times Ran"
              },
              "properties": [
                {
                  "id": "custom.minWidth",
                  "value": 50
                }
              ]
            }
          ]
        },
        "gridPos": {
          "h": 8,
          "w": 6,
          "x": 0,
          "y": 25
        },
        "id": 16,
        "options": {
          "cellHeight": "sm",
          "footer": {
            "countRows": false,
            "fields": "",
            "reducer": [
              "sum"
            ],
            "show": false
          },
          "showHeader": true
        },
        "pluginVersion": "10.1.5",
        "targets": [
          {
            "datasource": {
              "type": "postgres",
              "uid": "${DS_CHRIS_POSTGRESQL}"
            },
            "editorMode": "code",
            "format": "table",
            "rawQuery": true,
            "rawSql": "SELECT plugins_plugin.dock_image AS \"Plugin\", \nCOUNT(*) AS \"Times Ran\"\nFROM plugininstances_plugininstance\nINNER JOIN plugins_plugin ON plugins_plugin.id = plugininstances_plugininstance.plugin_id\nWHERE plugininstances_plugininstance.status != 'cancelled'\nGROUP BY plugins_plugin.dock_image\nORDER BY COUNT(*) DESC",
            "refId": "A",
            "sql": {
              "columns": [
                {
                  "parameters": [],
                  "type": "function"
                }
              ],
              "groupBy": [
                {
                  "property": {
                    "type": "string"
                  },
                  "type": "groupBy"
                }
              ],
              "limit": 50
            }
          }
        ],
        "title": "Plugin Frequency by Image Type (All Time)",
        "type": "table"
      },
      {
        "datasource": {
          "type": "postgres",
          "uid": "${DS_CHRIS_POSTGRESQL}"
        },
        "fieldConfig": {
          "defaults": {
            "color": {
              "mode": "thresholds"
            },
            "custom": {
              "align": "auto",
              "cellOptions": {
                "type": "auto"
              },
              "inspect": false
            },
            "mappings": [],
            "thresholds": {
              "mode": "absolute",
              "steps": [
                {
                  "color": "green",
                  "value": null
                },
                {
                  "color": "red",
                  "value": 80
                }
              ]
            }
          },
          "overrides": [
            {
              "matcher": {
                "id": "byName",
                "options": "Username"
              },
              "properties": [
                {
                  "id": "custom.width",
                  "value": 125
                }
              ]
            },
            {
              "matcher": {
                "id": "byName",
                "options": "Count"
              },
              "properties": [
                {
                  "id": "custom.width",
                  "value": 75
                }
              ]
            }
          ]
        },
        "gridPos": {
          "h": 8,
          "w": 6,
          "x": 6,
          "y": 25
        },
        "id": 24,
        "options": {
          "cellHeight": "sm",
          "footer": {
            "countRows": false,
            "fields": "",
            "reducer": [
              "sum"
            ],
            "show": false
          },
          "showHeader": true
        },
        "pluginVersion": "10.1.5",
        "targets": [
          {
            "datasource": {
              "type": "postgres",
              "uid": "${DS_CHRIS_POSTGRESQL}"
            },
            "editorMode": "code",
            "format": "table",
            "rawQuery": true,
            "rawSql": "SELECT\n\tauth_user.username AS \"Username\",\n\tREGEXP_REPLACE(plugininstances_plugininstancefile.fname, '^.*/([^/]*?)(\\.[^/.]+)?$', '\\1') AS \"Filename\",\n\tCOUNT(*) AS \"Count\"\nFROM plugininstances_plugininstance\nINNER JOIN auth_user ON auth_user.id = plugininstances_plugininstance.owner_id\nINNER JOIN plugininstances_plugininstancefile ON plugininstances_plugininstancefile.plugin_inst_id = plugininstances_plugininstance.id\nGROUP BY auth_user.username, \"Filename\"\nHAVING COUNT(*) > 1\nORDER BY COUNT(*) DESC",
            "refId": "A",
            "sql": {
              "columns": [
                {
                  "parameters": [],
                  "type": "function"
                }
              ],
              "groupBy": [
                {
                  "property": {
                    "type": "string"
                  },
                  "type": "groupBy"
                }
              ],
              "limit": 50
            }
          }
        ],
        "title": "Most Commonly Used Files (All Time)",
        "type": "table"
      },
      {
        "datasource": {
          "type": "postgres",
          "uid": "${DS_CHRIS_POSTGRESQL}"
        },
        "description": "Counts the number of plugins that have returned a failure / success grouped by weeks",
        "fieldConfig": {
          "defaults": {
            "color": {
              "mode": "palette-classic"
            },
            "custom": {
              "axisCenteredZero": false,
              "axisColorMode": "text",
              "axisLabel": "",
              "axisPlacement": "auto",
              "barAlignment": 0,
              "drawStyle": "line",
              "fillOpacity": 25,
              "gradientMode": "none",
              "hideFrom": {
                "legend": false,
                "tooltip": false,
                "viz": false
              },
              "insertNulls": false,
              "lineInterpolation": "linear",
              "lineStyle": {
                "fill": "solid"
              },
              "lineWidth": 2,
              "pointSize": 5,
              "scaleDistribution": {
                "type": "linear"
              },
              "showPoints": "auto",
              "spanNulls": false,
              "stacking": {
                "group": "A",
                "mode": "none"
              },
              "thresholdsStyle": {
                "mode": "off"
              }
            },
            "mappings": [],
            "min": 0,
            "thresholds": {
              "mode": "absolute",
              "steps": [
                {
                  "color": "green",
                  "value": null
                },
                {
                  "color": "red",
                  "value": 80
                }
              ]
            }
          },
          "overrides": []
        },
        "gridPos": {
          "h": 8,
          "w": 12,
          "x": 12,
          "y": 25
        },
        "id": 15,
        "options": {
          "legend": {
            "calcs": [],
            "displayMode": "table",
            "placement": "bottom",
            "showLegend": true,
            "sortBy": "Name",
            "sortDesc": false
          },
          "tooltip": {
            "mode": "single",
            "sort": "none"
          }
        },
        "pluginVersion": "10.1.5",
        "targets": [
          {
            "datasource": {
              "type": "postgres",
              "uid": "${DS_CHRIS_POSTGRESQL}"
            },
            "editorMode": "code",
            "format": "table",
            "rawQuery": true,
            "rawSql": "SELECT\nDATE_TRUNC('week', end_date) AS \"time\",\nCOUNT(*) AS \"finishedSuccessfully\"\nFROM plugininstances_plugininstance\nWHERE\nstatus = 'finishedSuccessfully'\nGROUP BY end_date",
            "refId": "A",
            "sql": {
              "columns": [
                {
                  "name": "COUNT",
                  "parameters": [
                    {
                      "name": "*",
                      "type": "functionParameter"
                    }
                  ],
                  "type": "function"
                },
                {
                  "parameters": [],
                  "type": "function"
                }
              ],
              "groupBy": [],
              "limit": 50
            },
            "table": "plugininstances_plugininstance"
          },
          {
            "datasource": {
              "type": "postgres",
              "uid": "${DS_CHRIS_POSTGRESQL}"
            },
            "editorMode": "code",
            "format": "table",
            "hide": false,
            "rawQuery": true,
            "rawSql": "SELECT\nDATE_TRUNC('week', end_date) AS \"time\",\nCOUNT(*) AS \"finishedWithError\"\nFROM plugininstances_plugininstance\nWHERE\nstatus = 'finishedWithError'\nGROUP BY end_date",
            "refId": "B",
            "sql": {
              "columns": [
                {
                  "parameters": [],
                  "type": "function"
                }
              ],
              "groupBy": [
                {
                  "property": {
                    "type": "string"
                  },
                  "type": "groupBy"
                }
              ],
              "limit": 50
            }
          }
        ],
        "title": "Plugins Exiting with Success vs. Failure by Week",
        "transformations": [
          {
            "id": "groupBy",
            "options": {
              "fields": {
                "finishedSuccessfully": {
                  "aggregations": [
                    "count"
                  ],
                  "operation": "aggregate"
                },
                "finishedWithError": {
                  "aggregations": [
                    "count"
                  ],
                  "operation": "aggregate"
                },
                "time": {
                  "aggregations": [],
                  "operation": "groupby"
                }
              }
            }
          }
        ],
        "type": "timeseries"
      },
      {
        "datasource": {
          "type": "prometheus",
          "uid": "${DS_PROMETHEUS}"
        },
        "fieldConfig": {
          "defaults": {
            "color": {
              "mode": "thresholds"
            },
            "custom": {
              "align": "auto",
              "cellOptions": {
                "type": "auto"
              },
              "filterable": false,
              "inspect": false
            },
            "mappings": [],
            "thresholds": {
              "mode": "absolute",
              "steps": [
                {
                  "color": "green",
                  "value": null
                },
                {
                  "color": "red",
                  "value": 80
                }
              ]
            }
          },
          "overrides": [
            {
              "matcher": {
                "id": "byName",
                "options": "Value #A (mean)"
              },
              "properties": [
                {
                  "id": "displayName",
                  "value": "Avg CPU (Use s)"
                },
                {
                  "id": "custom.minWidth",
                  "value": 130
                }
              ]
            },
            {
              "matcher": {
                "id": "byName",
                "options": "Value #A (max)"
              },
              "properties": [
                {
                  "id": "displayName",
                  "value": "Max CPU (Use s)"
                },
                {
                  "id": "custom.minWidth",
                  "value": 130
                }
              ]
            },
            {
              "matcher": {
                "id": "byName",
                "options": "Value #B (mean)"
              },
              "properties": [
                {
                  "id": "displayName",
                  "value": "Avg Mem (GB)"
                },
                {
                  "id": "custom.minWidth",
                  "value": 120
                }
              ]
            },
            {
              "matcher": {
                "id": "byName",
                "options": "Value #B (max)"
              },
              "properties": [
                {
                  "id": "displayName",
                  "value": "Max Mem (GB)"
                },
                {
                  "id": "custom.minWidth",
                  "value": 120
                }
              ]
            },
            {
              "matcher": {
                "id": "byName",
                "options": "Value #C (mean)"
              },
              "properties": [
                {
                  "id": "displayName",
                  "value": "Avg Runtime (s)"
                },
                {
                  "id": "custom.minWidth",
                  "value": 125
                }
              ]
            },
            {
              "matcher": {
                "id": "byName",
                "options": "Value #C (max)"
              },
              "properties": [
                {
                  "id": "displayName",
                  "value": "Max Runtime (s)"
                },
                {
                  "id": "custom.minWidth",
                  "value": 125
                }
              ]
            },
            {
              "matcher": {
                "id": "byName",
                "options": "image"
              },
              "properties": [
                {
                  "id": "custom.minWidth",
                  "value": 250
                },
                {
                  "id": "displayName",
                  "value": "Plugin Type"
                }
              ]
            }
          ]
        },
        "gridPos": {
          "h": 8,
          "w": 12,
          "x": 0,
          "y": 33
        },
        "id": 23,
        "interval": "15s",
        "options": {
          "cellHeight": "sm",
          "footer": {
            "countRows": false,
            "fields": [],
            "reducer": [
              "sum"
            ],
            "show": false
          },
          "frameIndex": 0,
          "showHeader": true,
          "sortBy": [
            {
              "desc": true,
              "displayName": "Avg CPU (CPU use seconds)"
            }
          ]
        },
        "pluginVersion": "10.1.5",
        "targets": [
          {
            "datasource": {
              "type": "prometheus",
              "uid": "${DS_PROMETHEUS}"
            },
            "editorMode": "code",
            "expr": "sum (   pod:container_cpu_usage:sum{pod=~\"chris-jid-.+\"}   * on(namespace, pod) group_right(image_spec) kube_pod_container_info{} ) by(image)",
            "format": "table",
            "legendFormat": "{{image}}",
            "range": true,
            "refId": "A"
          },
          {
            "datasource": {
              "type": "prometheus",
              "uid": "${DS_PROMETHEUS}"
            },
            "editorMode": "code",
            "expr": "sum by(image) (container_memory_working_set_bytes{container=~\"chris-jid-.+\"}) / 1000000000",
            "format": "table",
            "legendFormat": "{{image}}",
            "range": true,
            "refId": "B"
          },
          {
            "datasource": {
              "type": "prometheus",
              "uid": "${DS_PROMETHEUS}"
            },
            "editorMode": "code",
            "expr": "avg by (image) (last_over_time(timestamp((kube_pod_start_time{}   * on(namespace, pod) group_right(image_spec) kube_pod_container_info{pod=~\"chris-jid.+\"}))[1w:]) -    (kube_pod_start_time{}   * on(namespace, pod) group_right(image_spec) kube_pod_container_info{pod=~\"chris-jid.+\"}))",
            "format": "table",
            "legendFormat": "{{image}}",
            "range": true,
            "refId": "C"
          }
        ],
        "title": "Overall Plugin Resource Use",
        "transformations": [
          {
            "id": "merge",
            "options": {}
          },
          {
            "id": "configFromData",
            "options": {
              "applyTo": {
                "id": "byType",
                "options": "number"
              },
              "configRefId": "config",
              "mappings": []
            }
          },
          {
            "id": "groupBy",
            "options": {
              "fields": {
                "Value #A": {
                  "aggregations": [
                    "mean",
                    "max"
                  ],
                  "operation": "aggregate"
                },
                "Value #B": {
                  "aggregations": [
                    "mean",
                    "max"
                  ],
                  "operation": "aggregate"
                },
                "Value #C": {
                  "aggregations": [
                    "mean",
                    "max"
                  ],
                  "operation": "aggregate"
                },
                "image": {
                  "aggregations": [],
                  "operation": "groupby"
                }
              }
            }
          },
          {
            "id": "organize",
            "options": {
              "excludeByName": {},
              "indexByName": {
                "Value #A (max)": 4,
                "Value #A (mean)": 1,
                "Value #B (max)": 5,
                "Value #B (mean)": 2,
                "Value #C (max)": 6,
                "Value #C (mean)": 3,
                "image": 0
              },
              "renameByName": {}
            }
          }
        ],
        "type": "table"
      },
      {
        "collapsed": false,
        "gridPos": {
          "h": 1,
          "w": 24,
          "x": 0,
          "y": 41
        },
        "id": 29,
        "panels": [],
        "title": "System Metrics",
        "type": "row"
      },
      {
        "datasource": {
          "type": "prometheus",
          "uid": "${DS_PROMETHEUS}"
        },
        "fieldConfig": {
          "defaults": {
            "color": {
              "mode": "palette-classic"
            },
            "custom": {
              "axisCenteredZero": false,
              "axisColorMode": "text",
              "axisLabel": "",
              "axisPlacement": "auto",
              "barAlignment": 0,
              "drawStyle": "line",
              "fillOpacity": 0,
              "gradientMode": "none",
              "hideFrom": {
                "legend": false,
                "tooltip": false,
                "viz": false
              },
              "insertNulls": false,
              "lineInterpolation": "linear",
              "lineWidth": 1,
              "pointSize": 5,
              "scaleDistribution": {
                "type": "linear"
              },
              "showPoints": "auto",
              "spanNulls": false,
              "stacking": {
                "group": "A",
                "mode": "none"
              },
              "thresholdsStyle": {
                "mode": "off"
              }
            },
            "mappings": [],
            "thresholds": {
              "mode": "absolute",
              "steps": [
                {
                  "color": "green",
                  "value": null
                },
                {
                  "color": "red",
                  "value": 80
                }
              ]
            }
          },
          "overrides": []
        },
        "gridPos": {
          "h": 8,
          "w": 12,
          "x": 0,
          "y": 42
        },
        "id": 36,
        "interval": "15s",
        "options": {
          "legend": {
            "calcs": [],
            "displayMode": "table",
            "placement": "bottom",
            "showLegend": true
          },
          "tooltip": {
            "mode": "single",
            "sort": "none"
          }
        },
        "targets": [
          {
            "datasource": {
              "type": "prometheus",
              "uid": "${DS_PROMETHEUS}"
            },
            "disableTextWrap": false,
            "editorMode": "builder",
            "expr": "sum(node_namespace_pod_container:container_cpu_usage_seconds_total:sum_irate{namespace='hosting-of-medical-image-analysis-platform-a88466'}) by (pod)",
            "fullMetaSearch": false,
            "includeNullMetadata": true,
            "instant": false,
            "legendFormat": "__auto",
            "range": true,
            "refId": "A",
            "useBackend": false
          }
        ],
        "title": "CPU Use by Pod (in CPU Use seconds)",
        "type": "timeseries"
      },
      {
        "datasource": {
          "type": "prometheus",
          "uid": "${DS_PROMETHEUS}"
        },
        "fieldConfig": {
          "defaults": {
            "color": {
              "mode": "palette-classic"
            },
            "custom": {
              "axisCenteredZero": false,
              "axisColorMode": "text",
              "axisLabel": "",
              "axisPlacement": "auto",
              "barAlignment": 0,
              "drawStyle": "line",
              "fillOpacity": 0,
              "gradientMode": "none",
              "hideFrom": {
                "legend": false,
                "tooltip": false,
                "viz": false
              },
              "insertNulls": false,
              "lineInterpolation": "linear",
              "lineWidth": 1,
              "pointSize": 5,
              "scaleDistribution": {
                "type": "linear"
              },
              "showPoints": "auto",
              "spanNulls": false,
              "stacking": {
                "group": "A",
                "mode": "none"
              },
              "thresholdsStyle": {
                "mode": "off"
              }
            },
            "mappings": [],
            "noValue": "0",
            "thresholds": {
              "mode": "absolute",
              "steps": [
                {
                  "color": "green",
                  "value": null
                },
                {
                  "color": "red",
                  "value": 80
                }
              ]
            }
          },
          "overrides": []
        },
        "gridPos": {
          "h": 8,
          "w": 12,
          "x": 12,
          "y": 42
        },
        "id": 31,
        "options": {
          "legend": {
            "calcs": [],
            "displayMode": "list",
            "placement": "bottom",
            "showLegend": true
          },
          "tooltip": {
            "mode": "single",
            "sort": "none"
          }
        },
        "targets": [
          {
            "datasource": {
              "type": "prometheus",
              "uid": "${DS_PROMETHEUS}"
            },
            "editorMode": "code",
            "expr": "sum by(pod) (pod:container_cpu_usage:sum{pod=~\"chris-jid-.+\"})",
            "instant": false,
            "legendFormat": "{{pod}}",
            "range": true,
            "refId": "A"
          }
        ],
        "title": "CPU Use by Plugin Pods (in CPU Use seconds)",
        "type": "timeseries"
      },
      {
        "datasource": {
          "type": "prometheus",
          "uid": "${DS_PROMETHEUS}"
        },
        "fieldConfig": {
          "defaults": {
            "color": {
              "mode": "palette-classic"
            },
            "custom": {
              "axisCenteredZero": false,
              "axisColorMode": "text",
              "axisLabel": "",
              "axisPlacement": "auto",
              "barAlignment": 0,
              "drawStyle": "line",
              "fillOpacity": 0,
              "gradientMode": "none",
              "hideFrom": {
                "legend": false,
                "tooltip": false,
                "viz": false
              },
              "insertNulls": false,
              "lineInterpolation": "linear",
              "lineWidth": 1,
              "pointSize": 5,
              "scaleDistribution": {
                "type": "linear"
              },
              "showPoints": "auto",
              "spanNulls": false,
              "stacking": {
                "group": "A",
                "mode": "none"
              },
              "thresholdsStyle": {
                "mode": "off"
              }
            },
            "mappings": [],
            "thresholds": {
              "mode": "absolute",
              "steps": [
                {
                  "color": "green",
                  "value": null
                },
                {
                  "color": "red",
                  "value": 80
                }
              ]
            },
            "unit": "decbytes"
          },
          "overrides": []
        },
        "gridPos": {
          "h": 8,
          "w": 12,
          "x": 0,
          "y": 50
        },
        "id": 32,
        "interval": "15s",
        "options": {
          "legend": {
            "calcs": [],
            "displayMode": "table",
            "placement": "bottom",
            "showLegend": true
          },
          "tooltip": {
            "mode": "single",
            "sort": "none"
          }
        },
        "targets": [
          {
            "datasource": {
              "type": "prometheus",
              "uid": "${DS_PROMETHEUS}"
            },
            "editorMode": "code",
            "expr": "sum(container_memory_working_set_bytes{container!=\"\", namespace='hosting-of-medical-image-analysis-platform-a88466'}) by (pod)",
            "legendFormat": "{{pod}}",
            "range": true,
            "refId": "A"
          }
        ],
        "title": "Memory Use by Pod",
        "type": "timeseries"
      },
      {
        "datasource": {
          "type": "prometheus",
          "uid": "${DS_PROMETHEUS}"
        },
        "fieldConfig": {
          "defaults": {
            "color": {
              "mode": "palette-classic"
            },
            "custom": {
              "axisCenteredZero": false,
              "axisColorMode": "text",
              "axisLabel": "",
              "axisPlacement": "auto",
              "barAlignment": 0,
              "drawStyle": "line",
              "fillOpacity": 0,
              "gradientMode": "none",
              "hideFrom": {
                "legend": false,
                "tooltip": false,
                "viz": false
              },
              "insertNulls": false,
              "lineInterpolation": "linear",
              "lineWidth": 1,
              "pointSize": 5,
              "scaleDistribution": {
                "type": "linear"
              },
              "showPoints": "auto",
              "spanNulls": false,
              "stacking": {
                "group": "A",
                "mode": "none"
              },
              "thresholdsStyle": {
                "mode": "off"
              }
            },
            "mappings": [],
            "noValue": "0",
            "thresholds": {
              "mode": "absolute",
              "steps": [
                {
                  "color": "green",
                  "value": null
                },
                {
                  "color": "red",
                  "value": 80
                }
              ]
            },
            "unit": "decbytes"
          },
          "overrides": []
        },
        "gridPos": {
          "h": 8,
          "w": 12,
          "x": 12,
          "y": 50
        },
        "id": 33,
        "interval": "15s",
        "options": {
          "legend": {
            "calcs": [],
            "displayMode": "list",
            "placement": "bottom",
            "showLegend": true
          },
          "tooltip": {
            "mode": "single",
            "sort": "none"
          }
        },
        "targets": [
          {
            "datasource": {
              "type": "prometheus",
              "uid": "${DS_PROMETHEUS}"
            },
            "editorMode": "code",
            "expr": "sum by(pod) (container_memory_working_set_bytes{pod=~\"chris-jid.+\"})",
            "instant": false,
            "legendFormat": "{{pod}}",
            "range": true,
            "refId": "A"
          }
        ],
        "title": "Memory Use by Plugin Pods",
        "type": "timeseries"
      },
      {
        "datasource": {
          "type": "prometheus",
          "uid": "${DS_PROMETHEUS}"
        },
        "fieldConfig": {
          "defaults": {
            "color": {
              "mode": "palette-classic"
            },
            "custom": {
              "axisCenteredZero": false,
              "axisColorMode": "text",
              "axisLabel": "",
              "axisPlacement": "auto",
              "barAlignment": 0,
              "drawStyle": "line",
              "fillOpacity": 0,
              "gradientMode": "none",
              "hideFrom": {
                "legend": false,
                "tooltip": false,
                "viz": false
              },
              "insertNulls": false,
              "lineInterpolation": "linear",
              "lineWidth": 1,
              "pointSize": 5,
              "scaleDistribution": {
                "type": "linear"
              },
              "showPoints": "auto",
              "spanNulls": false,
              "stacking": {
                "group": "A",
                "mode": "none"
              },
              "thresholdsStyle": {
                "mode": "off"
              }
            },
            "mappings": [],
            "thresholds": {
              "mode": "absolute",
              "steps": [
                {
                  "color": "green",
                  "value": null
                },
                {
                  "color": "red",
                  "value": 80
                }
              ]
            },
            "unit": "decbytes"
          },
          "overrides": []
        },
        "gridPos": {
          "h": 8,
          "w": 12,
          "x": 0,
          "y": 58
        },
        "id": 34,
        "interval": "15s",
        "options": {
          "legend": {
            "calcs": [],
            "displayMode": "table",
            "placement": "bottom",
            "showLegend": true
          },
          "tooltip": {
            "mode": "single",
            "sort": "none"
          }
        },
        "targets": [
          {
            "datasource": {
              "type": "prometheus",
              "uid": "${DS_PROMETHEUS}"
            },
            "editorMode": "code",
            "expr": "topk(25, sort_desc(sum(pod:container_fs_usage_bytes:sum{container=\"\",pod!=\"\",namespace='hosting-of-medical-image-analysis-platform-a88466'}) BY (pod, namespace)))",
            "instant": false,
            "legendFormat": "{{pod}}",
            "range": true,
            "refId": "A"
          }
        ],
        "title": "Pod Filesystem Use",
        "type": "timeseries"
      },
      {
        "datasource": {
          "type": "prometheus",
          "uid": "${DS_PROMETHEUS}"
        },
        "fieldConfig": {
          "defaults": {
            "color": {
              "mode": "palette-classic"
            },
            "custom": {
              "axisCenteredZero": false,
              "axisColorMode": "text",
              "axisLabel": "",
              "axisPlacement": "auto",
              "barAlignment": 0,
              "drawStyle": "line",
              "fillOpacity": 0,
              "gradientMode": "none",
              "hideFrom": {
                "legend": false,
                "tooltip": false,
                "viz": false
              },
              "insertNulls": false,
              "lineInterpolation": "linear",
              "lineWidth": 1,
              "pointSize": 5,
              "scaleDistribution": {
                "type": "linear"
              },
              "showPoints": "auto",
              "spanNulls": false,
              "stacking": {
                "group": "A",
                "mode": "none"
              },
              "thresholdsStyle": {
                "mode": "off"
              }
            },
            "mappings": [],
            "noValue": "0",
            "thresholds": {
              "mode": "absolute",
              "steps": [
                {
                  "color": "green",
                  "value": null
                },
                {
                  "color": "red",
                  "value": 80
                }
              ]
            },
            "unit": "decbytes"
          },
          "overrides": []
        },
        "gridPos": {
          "h": 8,
          "w": 12,
          "x": 12,
          "y": 58
        },
        "id": 35,
        "options": {
          "legend": {
            "calcs": [],
            "displayMode": "list",
            "placement": "bottom",
            "showLegend": true
          },
          "tooltip": {
            "mode": "single",
            "sort": "none"
          }
        },
        "targets": [
          {
            "datasource": {
              "type": "prometheus",
              "uid": "${DS_PROMETHEUS}"
            },
            "editorMode": "code",
            "expr": "topk(25, sort_desc(sum(pod:container_fs_usage_bytes:sum{container=\"\",pod=~\"chris-jid.+\",namespace='hosting-of-medical-image-analysis-platform-a88466'}) by (pod, namespace)))",
            "instant": false,
            "legendFormat": "{{pod}}",
            "range": true,
            "refId": "A"
          }
        ],
        "title": "Filesystem Use by Plugin Pods",
        "type": "timeseries"
      },
      {
        "datasource": {
          "type": "prometheus",
          "uid": "${DS_PROMETHEUS}"
        },
        "fieldConfig": {
          "defaults": {
            "mappings": [],
            "thresholds": {
              "mode": "percentage",
              "steps": [
                {
                  "color": "green",
                  "value": null
                },
                {
                  "color": "orange",
                  "value": 70
                },
                {
                  "color": "red",
                  "value": 85
                }
              ]
            },
            "unit": "percentunit"
          },
          "overrides": []
        },
        "gridPos": {
          "h": 15,
          "w": 12,
          "x": 0,
          "y": 66
        },
        "id": 37,
        "options": {
          "orientation": "auto",
          "reduceOptions": {
            "calcs": [
              "lastNotNull"
            ],
            "fields": "",
            "values": false
          },
          "showThresholdLabels": false,
          "showThresholdMarkers": true
        },
        "pluginVersion": "10.1.5",
        "targets": [
          {
            "datasource": {
              "type": "prometheus",
              "uid": "${DS_PROMETHEUS}"
            },
            "editorMode": "code",
            "expr": "sum(node_namespace_pod_container:container_cpu_usage_seconds_total:sum_irate{cluster=\"\", namespace=\"hosting-of-medical-image-analysis-platform-a88466\"}) / sum(kube_pod_container_resource_limits{job=\"kube-state-metrics\", cluster=\"\", namespace=\"hosting-of-medical-image-analysis-platform-a88466\", resource=\"cpu\"})",
            "instant": false,
            "legendFormat": "% CPU Use (Limits)",
            "range": true,
            "refId": "A"
          },
          {
            "datasource": {
              "type": "prometheus",
              "uid": "${DS_PROMETHEUS}"
            },
            "editorMode": "code",
            "expr": "sum(node_namespace_pod_container:container_cpu_usage_seconds_total:sum_irate{cluster=\"\", namespace=\"hosting-of-medical-image-analysis-platform-a88466\"}) / sum(kube_pod_container_resource_requests{job=\"kube-state-metrics\", cluster=\"\", namespace=\"hosting-of-medical-image-analysis-platform-a88466\", resource=\"cpu\"})",
            "hide": false,
            "instant": false,
            "legendFormat": "% CPU Use (Requests)",
            "range": true,
            "refId": "B"
          },
          {
            "datasource": {
              "type": "prometheus",
              "uid": "${DS_PROMETHEUS}"
            },
            "editorMode": "code",
            "expr": "sum(container_memory_working_set_bytes{job=\"kubelet\", metrics_path=\"/metrics/cadvisor\", cluster=\"\", namespace=\"hosting-of-medical-image-analysis-platform-a88466\",container!=\"\", image!=\"\"}) / sum(kube_pod_container_resource_limits{job=\"kube-state-metrics\", cluster=\"\", namespace=\"hosting-of-medical-image-analysis-platform-a88466\", resource=\"memory\"})",
            "hide": false,
            "instant": false,
            "legendFormat": "% Memory Use (Limits)",
            "range": true,
            "refId": "C"
          },
          {
            "datasource": {
              "type": "prometheus",
              "uid": "${DS_PROMETHEUS}"
            },
            "editorMode": "code",
            "expr": "sum(container_memory_working_set_bytes{job=\"kubelet\", metrics_path=\"/metrics/cadvisor\", cluster=\"\", namespace=\"hosting-of-medical-image-analysis-platform-a88466\",container!=\"\", image!=\"\"}) / sum(kube_pod_container_resource_limits{job=\"kube-state-metrics\", cluster=\"\", namespace=\"hosting-of-medical-image-analysis-platform-a88466\", resource=\"memory\"})",
            "hide": false,
            "instant": false,
            "legendFormat": "% Memory Use (Requests)",
            "range": true,
            "refId": "D"
          }
        ],
        "title": "% of Total CPU and Memory Resources in Use",
        "type": "gauge"
      },
      {
        "datasource": {
          "type": "prometheus",
          "uid": "${DS_PROMETHEUS}"
        },
        "fieldConfig": {
          "defaults": {
            "color": {
              "mode": "palette-classic"
            },
            "custom": {
              "axisCenteredZero": false,
              "axisColorMode": "text",
              "axisLabel": "",
              "axisPlacement": "auto",
              "barAlignment": 0,
              "drawStyle": "line",
              "fillOpacity": 0,
              "gradientMode": "none",
              "hideFrom": {
                "legend": false,
                "tooltip": false,
                "viz": false
              },
              "insertNulls": false,
              "lineInterpolation": "linear",
              "lineWidth": 1,
              "pointSize": 5,
              "scaleDistribution": {
                "type": "linear"
              },
              "showPoints": "auto",
              "spanNulls": false,
              "stacking": {
                "group": "A",
                "mode": "none"
              },
              "thresholdsStyle": {
                "mode": "off"
              }
            },
            "mappings": [],
            "noValue": "0",
            "thresholds": {
              "mode": "absolute",
              "steps": [
                {
                  "color": "green",
                  "value": null
                },
                {
                  "color": "red",
                  "value": 80
                }
              ]
            },
            "unit": "percentunit"
          },
          "overrides": []
        },
        "gridPos": {
          "h": 8,
          "w": 12,
          "x": 12,
          "y": 66
        },
        "id": 42,
        "options": {
          "legend": {
            "calcs": [],
            "displayMode": "list",
            "placement": "bottom",
            "showLegend": true
          },
          "tooltip": {
            "mode": "single",
            "sort": "none"
          }
        },
        "targets": [
          {
            "datasource": {
              "type": "prometheus",
              "uid": "${DS_PROMETHEUS}"
            },
            "editorMode": "code",
            "expr": "sum by (namespace,pod) ((container_cpu_cfs_throttled_periods_total{pod=~\"chris-jid.+\", container=~\"chris-jid.+\"} / container_cpu_cfs_periods_total{pod=~\"chris-jid.+\", }))",
            "instant": false,
            "legendFormat": "{{pod}}",
            "range": true,
            "refId": "A"
          }
        ],
        "title": "CPU Throttling Percentage by Plugin Pod",
        "type": "timeseries"
      },
      {
        "collapsed": false,
        "gridPos": {
          "h": 1,
          "w": 24,
          "x": 0,
          "y": 81
        },
        "id": 26,
        "panels": [],
        "title": "System Logs",
        "type": "row"
      },
      {
        "datasource": {
          "type": "loki",
          "uid": "${DS_CHRIS_LOKI}"
        },
        "gridPos": {
          "h": 8,
          "w": 12,
          "x": 0,
          "y": 82
        },
        "id": 19,
        "options": {
          "dedupStrategy": "none",
          "enableLogDetails": true,
          "prettifyLogMessage": false,
          "showCommonLabels": false,
          "showLabels": false,
          "showTime": false,
          "sortOrder": "Descending",
          "wrapLogMessage": false
        },
        "pluginVersion": "10.1.5",
        "targets": [
          {
            "datasource": {
              "type": "loki",
              "uid": "${DS_CHRIS_LOKI}"
            },
            "editorMode": "builder",
            "expr": "{pod=~\"chris.+\"} |= ``",
            "maxLines": 50,
            "queryType": "range",
            "refId": "A"
          }
        ],
        "title": "Most Recent ChRIS Logs",
        "type": "logs"
      },
      {
        "datasource": {
          "type": "loki",
          "uid": "${DS_CHRIS_LOKI}"
        },
        "gridPos": {
          "h": 8,
          "w": 12,
          "x": 12,
          "y": 82
        },
        "id": 18,
        "options": {
          "dedupStrategy": "none",
          "enableLogDetails": true,
          "prettifyLogMessage": false,
          "showCommonLabels": false,
          "showLabels": false,
          "showTime": false,
          "sortOrder": "Descending",
          "wrapLogMessage": false
        },
        "pluginVersion": "10.1.5",
        "targets": [
          {
            "datasource": {
              "type": "loki",
              "uid": "${DS_CHRIS_LOKI}"
            },
            "editorMode": "builder",
            "expr": "{pod=~\"chris-jid.+\"}",
            "legendFormat": "pod",
            "queryType": "range",
            "refId": "A"
          }
        ],
        "title": "Plugin Logs",
        "type": "logs"
      },
      {
        "datasource": {
          "type": "loki",
          "uid": "${DS_CHRIS_LOKI}"
        },
        "description": "Panel of all logs that follow the format that include an error code value",
        "gridPos": {
          "h": 8,
          "w": 12,
          "x": 0,
          "y": 90
        },
        "id": 28,
        "options": {
          "dedupStrategy": "none",
          "enableLogDetails": true,
          "prettifyLogMessage": false,
          "showCommonLabels": false,
          "showLabels": false,
          "showTime": false,
          "sortOrder": "Descending",
          "wrapLogMessage": false
        },
        "targets": [
          {
            "datasource": {
              "type": "loki",
              "uid": "${DS_CHRIS_LOKI}"
            },
            "editorMode": "code",
            "expr": "{pod=~\"chris.+\"} |~ \".+CODE.+\"",
            "maxLines": 200,
            "queryType": "range",
            "refId": "A"
          }
        ],
        "title": "Most Recent Plugin Errors",
        "type": "logs"
      }
    ],
    "refresh": false,
    "schemaVersion": 38,
    "style": "dark",
    "tags": [],
    "templating": {
      "list": [
        {
          "current": {},
          "datasource": {
            "type": "postgres",
            "uid": "${DS_CHRIS_POSTGRESQL}"
          },
          "definition": "SELECT DISTINCT\n  dock_image\nFROM\n  plugins_plugin\nLIMIT\n  50",
          "description": "ChRIS Plugin Image",
          "hide": 0,
          "includeAll": true,
          "label": "ChRIS Plugin Image",
          "multi": true,
          "name": "ChRIS_Plugin_Image",
          "options": [],
          "query": "SELECT DISTINCT\n  dock_image\nFROM\n  plugins_plugin\nLIMIT\n  50",
          "refresh": 1,
          "regex": "",
          "skipUrlSync": false,
          "sort": 1,
          "type": "query"
        },
        {
          "current": {},
          "datasource": {
            "type": "postgres",
            "uid": "${DS_CHRIS_POSTGRESQL}"
          },
          "definition": "SELECT\n  plugininstances_plugininstance.id\nFROM plugininstances_plugininstance\nWHERE plugininstances_plugininstance.start_date BETWEEN $__timeFrom() AND $__timeTo()\nORDER BY plugininstances_plugininstance.start_date DESC\nLIMIT 50",
          "hide": 0,
          "includeAll": false,
          "multi": false,
          "name": "PluginPod",
          "options": [],
          "query": "SELECT\n  plugininstances_plugininstance.id\nFROM plugininstances_plugininstance\nWHERE plugininstances_plugininstance.start_date BETWEEN $__timeFrom() AND $__timeTo()\nORDER BY plugininstances_plugininstance.start_date DESC\nLIMIT 50",
          "refresh": 2,
          "regex": "",
          "skipUrlSync": false,
          "sort": 0,
          "type": "query"
        }
      ]
    },
    "time": {
      "from": "2023-12-14T23:58:13.266Z",
      "to": "2023-12-15T00:50:47.248Z"
    },
    "timepicker": {},
    "timezone": "",
    "title": "ChRIS Dashboard",
    "uid": "c994a710-00ca-4c7e-9b15-a7aae283c5e8",
    "version": 68,
    "weekStart": ""
  }
